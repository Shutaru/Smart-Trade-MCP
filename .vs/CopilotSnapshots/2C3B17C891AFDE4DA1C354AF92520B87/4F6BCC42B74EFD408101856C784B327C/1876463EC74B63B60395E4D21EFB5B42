// Minimal shim for lightweight-charts to allow build when dependency missing.
// Renders a lightweight SVG placeholder chart with gradient and grid lines.

export type UTCTimestamp = number

export interface ISeriesApi {
  setData(data: any[]): void
  setMarkers(markers: any[]): void
}

export interface IChartApi {
  remove(): void
  applyOptions(opts: any): void
  addCandlestickSeries(opts?: any): ISeriesApi
  addLineSeries(opts?: any): ISeriesApi
}

export default function createChart(container: HTMLElement, _options?: any): IChartApi {
  container.style.position = 'relative'
  // clear container
  container.innerHTML = ''

  const svgNS = 'http://www.w3.org/2000/svg'
  const svg = document.createElementNS(svgNS, 'svg')
  svg.setAttribute('width', '100%')
  svg.setAttribute('height', '100%')
  svg.setAttribute('viewBox', '0 0 800 300')
  svg.style.display = 'block'
  svg.style.borderRadius = '8px'
  svg.style.background = 'linear-gradient(180deg, rgba(250,250,250,0.9), rgba(245,245,245,0.9))'
  svg.style.boxShadow = 'inset 0 1px 0 rgba(255,255,255,0.6)'

  // grid
  for (let i = 0; i <= 4; i++) {
    const y = 40 + i * 50
    const line = document.createElementNS(svgNS, 'line')
    line.setAttribute('x1', '40')
    line.setAttribute('y1', String(y))
    line.setAttribute('x2', '760')
    line.setAttribute('y2', String(y))
    line.setAttribute('stroke', '#e6e6e6')
    line.setAttribute('stroke-width', '1')
    svg.appendChild(line)
  }

  // fake area/line path
  const path = document.createElementNS(svgNS, 'path')
  path.setAttribute('d', 'M40 220 C120 160 200 140 280 150 C360 160 440 120 520 130 C600 140 680 100 760 120')
  path.setAttribute('fill', 'none')
  path.setAttribute('stroke', 'url(#grad)')
  path.setAttribute('stroke-width', '3')
  path.setAttribute('stroke-linecap', 'round')
  svg.appendChild(path)

  // gradient
  const defs = document.createElementNS(svgNS, 'defs')
  const grad = document.createElementNS(svgNS, 'linearGradient')
  grad.setAttribute('id', 'grad')
  grad.setAttribute('x1', '0')
  grad.setAttribute('x2', '1')
  grad.setAttribute('y1', '0')
  grad.setAttribute('y2', '0')
  const stop1 = document.createElementNS(svgNS, 'stop')
  stop1.setAttribute('offset', '0%')
  stop1.setAttribute('stop-color', '#6d28d9')
  stop1.setAttribute('stop-opacity', '1')
  const stop2 = document.createElementNS(svgNS, 'stop')
  stop2.setAttribute('offset', '100%')
  stop2.setAttribute('stop-color', '#ec4899')
  stop2.setAttribute('stop-opacity', '1')
  grad.appendChild(stop1)
  grad.appendChild(stop2)
  defs.appendChild(grad)
  svg.appendChild(defs)

  // caption
  const caption = document.createElementNS(svgNS, 'text')
  caption.setAttribute('x', '50%')
  caption.setAttribute('y', '50%')
  caption.setAttribute('fill', '#9ca3af')
  caption.setAttribute('font-size', '14')
  caption.setAttribute('text-anchor', 'middle')
  caption.textContent = 'Chart unavailable - lightweight-charts not installed (placeholder)'
  caption.setAttribute('opacity', '0.0')
  svg.appendChild(caption)

  // subtle animation: draw path
  path.style.strokeDasharray = '1000'
  path.style.strokeDashoffset = '1000'
  path.style.transition = 'stroke-dashoffset 1.2s ease-out, opacity 0.6s ease'
  setTimeout(() => {
    path.style.strokeDashoffset = '0'
    caption.setAttribute('opacity', '1')
  }, 120)

  // append svg
  container.appendChild(svg)

  const makeSeries = (): ISeriesApi => ({
    setData(_data: any[]) {
      // noop: could animate based on data later
    },
    setMarkers(_markers: any[]) {
      // noop
    }
  })

  return {
    remove() {
      try { if (container.contains(svg)) container.removeChild(svg) } catch (e) { }
    },
    applyOptions(_opts: any) {
      // noop
    },
    addCandlestickSeries(_opts?: any) {
      return makeSeries()
    },
    addLineSeries(_opts?: any) {
      return makeSeries()
    }
  }
}

export { createChart as createChartShim }
